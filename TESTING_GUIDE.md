# Инструкция по тестированию ТСД функций

## Предварительные требования

1. **Устройство ТСД Ranger2K** с Android 13
2. **Установленное приложение** Warehouse Camera (обновленная версия)
3. **Тестовые штрихкоды** для сканирования

## Тест 1: Автоматическое определение ТСД

### Ожидаемое поведение:
1. Запустите приложение на ТСД Ranger2K
2. Перейдите к сканированию штрихкода
3. **Должно появиться:**
   - Сообщение "Обнаружен встроенный сканер Ranger2K"
   - Кнопка "Использовать камеру" (изначально скрыта встроенный сканер)
   - Инструкция "Нажмите кнопку сканирования на устройстве или используйте триггер"

### Проверка логов:
```
Логи Android Studio:
ScannerUtils: Detected TSD device: Ranger2K
BarcodeScannerActivity: Using TSD scanner mode
```

## Тест 2: Сканирование встроенным сканером

### Шаги:
1. Убедитесь что активен встроенный сканер
2. Наведите устройство на штрихкод
3. **Нажмите триггер или кнопку сканирования** на ТСД

### Ожидаемый результат:
- Штрихкод должен быть сразу считан
- Приложение должно вернуться к предыдущему экрану с результатом
- В логах: `TSD Scanner detected barcode: [код]`

## Тест 3: Переключение между сканерами

### Шаги:
1. В режиме встроенного сканера нажмите кнопку "Использовать камеру"
2. Должна появиться камера для сканирования
3. Нажмите кнопку "Использовать встроенный сканер"
4. Камера должна скрыться, активируется ТСД сканер

### Проверки:
- ✅ Кнопка меняет текст при переключении
- ✅ Статус текст обновляется ("Режим: Камера" / "Режим: Встроенный сканер")
- ✅ Интерфейс корректно переключается

## Тест 4: Сохранение текстовых аннотаций

### Подготовка:
1. Создайте приемку с производителем "TEST"
2. Добавьте артикул "12345678"
3. Выберите категорию дефекта, причину и шаблон
4. Перейдите к съемке фотографий

### Тест:
1. Сделайте фото повреждения или штрихкода
2. Нажмите "Use this photo"
3. **Ожидаемое поведение:**
   - Появится сообщение "Photo and text annotations saved successfully!"
   - В файловой системе должен создаться .txt файл

### Проверка файла:
```
Путь: DCIM/warehouse/TEST/[дата]/[категория]/12345678/12345678.txt

Содержимое должно включать:
- Артикул: 12345678
- Категория дефекта: [1-3]
- Причина: [выбранная причина]
- Шаблон: [выбранный шаблон]
- Описание: [введенное описание]
- Переводы на 3 языка
```

## Возможные проблемы и решения

### Проблема: ТСД не определяется автоматически
**Решение:**
1. Проверьте модель устройства в настройках Android
2. Добавьте модель в `ScannerUtils.KNOWN_TSD_DEVICES` если нужно
3. Используйте `ScannerUtils.showDeviceInfo()` для отладки

### Проблема: Встроенный сканер не реагирует
**Решение:**
1. Убедитесь что триггер/кнопка работает в других приложениях
2. Проверьте что BroadcastReceiver зарегистрирован
3. Попробуйте переключиться на камеру и обратно

### Проблема: Текстовые файлы не создаются
**Решение:**
1. Проверьте разрешения на запись в память
2. Убедитесь что DefectDetails передается в CameraActivity
3. Проверьте логи FileUtils на ошибки

### Проблема: Приложение крашится
**Решение:**
1. Проверьте все новые drawable и string ресурсы
2. Убедитесь что все файлы скомпилированы корректно
3. Проверьте совместимость с Android 13

## Контрольный список тестирования

### Функции ТСД:
- [ ] Автоматически определяется как ТСД устройство
- [ ] Показывается кнопка переключения сканеров
- [ ] Встроенный сканер считывает штрихкоды
- [ ] Переключение между режимами работает
- [ ] Жизненный цикл приложения корректно управляет сканером

### Функции аннотаций:
- [ ] Текстовые файлы создаются при съемке фото
- [ ] Содержимое файлов корректно и включает всю информацию
- [ ] Пользователь получает уведомления о статусе сохранения
- [ ] Файлы сохраняются в правильную директорию

### Обратная совместимость:
- [ ] На обычном телефоне работает как прежде
- [ ] Все существующие функции работают без изменений
- [ ] Файловая структура не нарушена

## Отчет о тестировании

Заполните после проведения тестов:

**Дата тестирования:** ___________  
**Устройство:** Ranger2K Android 13  
**Версия приложения:** 1.1.0  

**Результаты:**
- Автоматическое определение ТСД: ✅ / ❌
- Встроенный сканер: ✅ / ❌  
- Переключение сканеров: ✅ / ❌
- Сохранение аннотаций: ✅ / ❌
- Обратная совместимость: ✅ / ❌

**Заметки:**
_________________________________________________
_________________________________________________
_________________________________________________

**Рекомендации:**
_________________________________________________
_________________________________________________
_________________________________________________
